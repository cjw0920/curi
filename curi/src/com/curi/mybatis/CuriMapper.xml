<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com/curi/mybatis/CuriMapper.xml">





	<!-- product dao -->
	<select id="bestView" resultType="com.curi.dto.ProductDTO">
		<![CDATA[SELECT * FROM (SELECT * FROM curi_product ORDER BY p_purchasecnt DESC) WHERE ROWNUM<=4]]>
	</select>
	
	
	
	
	<!-- product dao -->
	<select id="newView" resultType="com.curi.dto.ProductDTO">
		<![CDATA[SELECT * FROM (SELECT * FROM curi_product ORDER BY p_indate DESC) WHERE ROWNUM<=4]]>
	</select>
	
	<select id="ProductDetailView" resultType="com.curi.dto.ProductDTO">
		
		<![CDATA[SELECT * FROM curi_product
				 WHERE p_code = #{p_code}]]>
	</select>	
	
	
	
	<!-- ========================================================== -->
	<!-- member dao -->
	
	<insert id="inserMember" parameterType="com.curi.dto.MemberDTO">
		INSERT INTO member(id, pw, name, phone, zipcode, addr1, addr2, email) 
		VALUES(#{id},#{pw},#{name},#{phone},#{zipcode},#{addr1},#{addr2},#{email})
	</insert>

	<select id="confirmId" parameterType="String" resultType="String">
		SELECT id FROM member WHERE id= #{userid}
	</select>
	
	<select id="confirmPw" parameterType="com.curi.dto.MemberDTO" resultType="String">
		SELECT id FROM member WHERE id= #{id} AND pw=#{pw}
	</select>
	
	<select id="loginCheck" parameterType="com.curi.dto.MemberDTO" resultType="com.curi.dto.MemberDTO">
		SELECT id FROM member WHERE id= #{id} AND pw=#{pw}
	</select>
	
	<select id="updateMember" parameterType="com.curi.dto.MemberDTO">
		UPDATE member set 
		pw =#{pw}, name=#{name}, phone=#{phone}, zipcode=#{zipcode}, addr1=#{addr1}, addr2=#{addr2}, email=#{email} 
		where id=#{id} 
	</select>
	
	<select id="updatePw" parameterType="com.curi.dto.MemberDTO">
		UPDATE member SET pw=#{pw} where id=#{id}
	</select>
	
	<delete id="deleteMember" parameterType="String">
		DELETE FROM member WHERE id = #{userid}
	</delete>
	
	<!-- ========================================================== -->
	
	<!-- Board -->
	
	<select id="countPaging" resultType="int">
		<![CDATA[SELECT count(bno) FROM curiboard WHERE bno > 0 ]]>
        
		                <if test='flag=="1"'>
		                	<![CDATA[AND title LIKE '%' || #{keyword}||'%']]> 
						</if>

						<if test='flag=="2"'>
		                	<![CDATA[AND writer LIKE '%' || #{keyword}||'%']]> 
						</if>			                 

						<if test='flag=="3"'>
		                	<![CDATA[AND content LIKE '%' || #{keyword}||'%']]> 
						</if>

						<if test='flag=="4"'>
		                	<![CDATA[AND title LIKE '%' || #{keyword}||'%' OR content LIKE '%' || #{keyword}||'%']]> 
						</if>
	</select>
	
	<select id="boardlist" resultType="com.curi.dto.BoardDTO">
		<![CDATA[SELECT * FROM (SELECT rownum rnum, 
       			 a.*
       			 FROM (SELECT *
		               	 FROM curiboard
		                 WHERE bno>0 ]]>               
		                 
		                <if test='flag=="1"'>
		                	<![CDATA[AND title LIKE '%' || #{keyword}||'%']]> 
						</if>

						<if test='flag=="2"'>
		                	<![CDATA[AND writer LIKE '%' || #{keyword}||'%']]> 
						</if>			                 

						<if test='flag=="3"'>
		                	<![CDATA[AND content LIKE '%' || #{keyword}||'%']]> 
						</if>

						<if test='flag=="4"'>
		                	<![CDATA[AND title LIKE '%' || #{keyword}||'%' OR content LIKE '%' || #{keyword}||'%']]> 
						</if>
						
						<if test='code=="new"'>
							ORDER BY bno DESC
						</if>
						
						<if test='code=="good"'>
							ORDER BY goodcnt DESC, bno DESC
						</if>
						
						<if test='code=="reply"'>
							ORDER BY replycnt DESC, bno DESC
						</if>
						
						<if test='code=="cnt"'>
							ORDER BY viewcnt DESC, bno DESC
						</if>						



		  <![CDATA[
    					) a 
 					)
				 WHERE rnum BETWEEN #{pageStart} AND #{perPageNum}]]> 
				 
				 
	</select>
	
	<select id="boardDetailView" resultType="com.curi.dto.BoardDTO">
		
		<![CDATA[SELECT * FROM curiboard
				 WHERE bno = #{bno}]]>
	</select>		
	
	<update id="viewCnt">
		
		<![CDATA[UPDATE curiboard SET viewcnt = viewcnt+1 WHERE bno = #{bno}]]>
		
	</update>
	
	<insert id="boardInsert" parameterType="com.curi.dto.BoardDTO">
	
		 
		<choose>
			<when test="content !=null">
				INSERT INTO curiboard(bno,title,content,writer,filename,filesize)
				VALUES(seq_curiboard.NEXTVAL,#{title},#{content},#{writer},#{filename},#{filesize})
			</when>
			<otherwise>
				INSERT INTO curiboard(bno,title,writer,filename,filesize)
				VALUES(seq_curiboard.NEXTVAL,#{title},#{writer},#{filename},#{filesize})
			</otherwise>
		</choose>
	</insert>
	
	<select id="boardUpdate" parameterType="com.curi.dto.BoardDTO">
			<choose>
			<when test="content !=null">
				
				UPDATE curiboard SET title=#{title},writer=#{writer},
				<if test="filename != 'no'">
					filename = #{filename},
					filesize = #{filesize},
				</if>
					content=#{content}
					 where bno=#{bno}
			</when>
			<otherwise>
				
				UPDATE curiboard SET title=#{title},writer=#{writer},
				<if test="filename != 'no'">
					filename = #{filename},
					filesize = #{filesize}
				</if>
					where bno=#{bno}
			</otherwise>
		</choose>
	</select>	
	
	<delete id="boardDelete" parameterType="int">
		DELETE FROM curiboard WHERE bno = #{bno}
	</delete>
	
	<!-- ========================================================== -->
	
	<!-- Reply -->
	<select id="replyListAll" parameterType="String" resultType="com.curi.dto.ReplyDTO">
		SELECT * FROM curireply
		WHERE bno = #{bno}
		ORDER BY rno ASC
	</select>
	
	<delete id="replyDelete" parameterType="String">
		DELETE FROM curireply WHERE rno = #{rno}
	</delete>
	
	
	<insert id="replyInsert"  parameterType="com.curi.dto.ReplyDTO">
	
	INSERT INTO curireply(rno,writer,content,bno)
	VALUES(seq_curireply_rno.NEXTVAL,#{writer},#{content},#{bno})
	
	</insert>
	
	<update id="rpPlus">
		UPDATE curiboard SET replycnt = replycnt+1
		WHERE bno = #{bno}
	</update>
	
	<update id="rpMinus">
		UPDATE curiboard SET replycnt = replycnt-1
		WHERE bno = #{bno}
	</update>
	
	
	
	<update id="replyUpdate" parameterType="com.curi.dto.ReplyDTO">
		UPDATE curireply SET content = #{content}
		WHERE rno = #{rno}
	</update>
	
	<!-- ========================================================== -->
	
	
</mapper>